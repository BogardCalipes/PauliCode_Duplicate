{%extends "base.html"%}
{% load static %}


{% block content %}


<style>
body { background-color: #1E2835; color: #e0e0e0; }
.card { background-color: #212529; color: #e0e0e0; border-radius: 8px; border: 1px solid #2b3a55; margin-bottom: 15px; }
.card-header { background-color: #1E2835; color: #00cc66; font-weight: bold; }
.editor-container { height: 500px; position: relative; }
.language-select { position: absolute; top: 10px; right: 10px; width: 120px; font-size: 0.85rem; z-index: 10; }
.test-case-box { background: #12181f; color: #00ff99; padding: 10px; border-radius: 6px; font-family: monospace; margin-bottom: 10px; border: 1px solid #2b3a55; }
#codeEditor { height: 100%; width: 100%; font-size: 14px; }
textarea#userInput { width: 100%; background: #12181f; color: #00ff99; border: 1px solid #2b3a55; border-radius: 6px; font-family: monospace; padding: 8px; margin-bottom: 10px; }
/* Add this CSS for loading spinner */
.loading-spinner {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 60px;
}
.loading-spinner .spinner-border {
  width: 2rem;
  height: 2rem;
  color: #28a745;
}
</style>

<div class="container-fluid mt-4">
  <div class="row">
    <!-- Problem Details -->
    <div class="col-md-3">
      <div class="card">
        <div class="card-header">Problem Details</div>
        <div class="card-body">
          <h5 class="card-title text-success">{{ problem.problem_title }}</h5>
          <p class="card-text" style="white-space: pre-line;">{{ problem.problem_description }}</p>

          <!-- hidden metadata for JS -->
          <div id="problemMeta"
               data-total-score="{{ problem.total_score }}"
               data-test-count="{{ problem.problemtestcase_set.all|length }}"
               style="display:none;"></div>
        </div>
      </div>
     
    </div>

    <!-- Code Editor -->
    <div class="col-md-6">
      <div class="card editor-container">
        <select id="language" class="form-select language-select text-white" style = "background-color: black;">
          <option value="python">Python</option>
          <option value="c">C</option>
          <option value="cpp">C++</option>
          <option value="java">Java</option>
        </select>
        <div id="codeEditor"># Write your code here</div>
      </div>
      <textarea id="userInput" placeholder="Enter input for input() calls here..."></textarea>
      <div class="d-flex justify-content-between mt-2">
        <button class="btn btn-success" onclick="runCode(false)" data-bs-toggle="modal" data-bs-target="#terminalModal">‚ñ∂ Run Code</button>
        <button class="btn btn-primary" onclick="runCode(true)" data-bs-toggle="modal" data-bs-target="#checkModal">üß© Check Code</button>
      </div>
    </div>

    <!-- Expected Output -->
    <div class="col-md-3">

      <!--Input-->
       <div class="card">
        <div class="card-header">Test Cases</div>
        <div class="card-body">
          {% for tc in problem.problemtestcase_set.all %}
            {% if forloop.counter != 3 %}
              <div class="test-case-box">Input {{ forloop.counter }}: {{ tc.input_data }}</div>
            {% else %}
              <div class="test-case-box">Input {{ forloop.counter }}: Hidden</div>
            {% endif %}
          {% empty %}
            <div>No test cases available.</div>
          {% endfor %}
        </div>
      </div>

  <div class="card">
    <div class="card-header">Expected Output</div>
    <div class="card-body">
      {% with total=problem.problemtestcase_set.all|length %}
      {% for tc in problem.problemtestcase_set.all %}
        <div class="test-case-box">
          {% if forloop.counter == total %}
            <!-- Hidden: show status badge only -->
            <span id="tcStatus{{ forloop.counter }}" class="badge bg-secondary">Hidden</span>
          {% else %}
            {{ tc.expected_output|linebreaksbr }}
            <span id="tcStatus{{ forloop.counter }}" class="badge bg-secondary ms-2">Pending</span>
          {% endif %}
        </div>
      {% empty %}
        <div>No expected outputs available.</div>
      {% endfor %}
      {% endwith %}
      <div class="mt-3">
        <span id="studentScoreBadge" class="badge bg-info text-dark" style="font-size:1rem;">
          Score: <span id="studentScoreValue">0</span>/<span id="studentScoreTotal">{{ problem.total_score }}</span>
        </span>
      </div>
    </div>
  </div>

   <!-- Time Remaining Card -->
<div class="card mt-3">
  <div class="card-header">‚è∞ Time Remaining</div>
  <div class="card-body text-center">
    <h4 id="timerDisplay" class="text-warning fw-bold">--:--</h4>
  </div>
</div>

<!-- Timer metadata (for JS) -->
<div id="problemTimer" data-timelimit="{{ problem.time_limit }}" style="display:none;"></div>


</div>

  </div>
</div>

<!-- Terminal Modal -->
<div class="modal fade" id="terminalModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content" style="background-color:#12181f; color:white;">
      <div class="modal-header">
        <h5 class="modal-title">Terminal Output</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <pre id="terminalOutput" style="white-space: pre-wrap; font-family: monospace; color:#00ff99;">Waiting for code execution...</pre>
      </div>
    </div>
  </div>
</div>

<!-- Check Result Modal -->
<div class="modal fade" id="checkModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="background-color:#12181f; color:white;">
      <div class="modal-header">
        <h5 class="modal-title">Code Check Result</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div id="checkResult" style="white-space: pre-wrap; font-family: monospace;"></div>
        <div id="checkLoading" class="loading-spinner" style="display:none;">
          <div class="spinner-border" role="status"></div>
          <span class="ms-2">Checking...</span>
        </div>
      </div>
      <div class="modal-footer">
        <!-- ‚úÖ Always visible after checking -->
        <button type="button" class="btn btn-success" id="submitBtn" onclick="submitCode()" style="display:none;">
          ‚úÖ Submit
        </button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

{% include "partials/scripts.html" %}


{% endblock %}
